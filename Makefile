# ====================================================
# Laravel Sail  + Git ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ Makefile
# ç›®çš„åˆ¥ã«é–‹ç™ºãƒ»æœ¬ç•ªãƒ»ä¸å…·åˆå¯¾å¿œã‚³ãƒãƒ³ãƒ‰ã‚’çµ±åˆ
# dev-flow: é–‹ç™ºã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ â†’ Gitã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥
# ====================================================

# Sailã‚³ãƒãƒ³ãƒ‰ã‚’å¤‰æ•°åŒ–ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯ php ã«å¤‰æ›´ã—ã¦ã‚‚OKï¼‰
SAIL = ./vendor/bin/sail
BRANCH = main

# =====================================
# ğŸš€ ç’°å¢ƒèµ·å‹•ï¼ˆå†èµ·å‹•ï¼‹ãƒ•ãƒ­ãƒ³ãƒˆèµ·å‹•ï¼‰
# =====================================
up:
	@echo "ğŸ”„ Sailç’°å¢ƒã‚’å†èµ·å‹•ã—ã¾ã™..."
	$(SAIL) down
	$(SAIL) up -d
	$(SAIL) npm run dev
	@echo "âœ… é–‹ç™ºç’°å¢ƒãŒèµ·å‹•ã—ã¾ã—ãŸï¼"

# =====================================
# ğŸ’¾ DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå…¨å†æ§‹ç¯‰ï¼‰
# =====================================
clear:
	@echo "ğŸ§© ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å†æ§‹ç¯‰ä¸­..."
	$(SAIL) artisan migrate:fresh
	$(SAIL) artisan migrate
	@echo "âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼"

# =====================================
# ğŸ§¹ é–‹ç™ºç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
# =====================================
dev-clear:
	@echo "ğŸ§¹ é–‹ç™ºç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ä¸­..."
	$(SAIL) artisan config:clear
	$(SAIL) artisan route:clear
	$(SAIL) artisan view:clear
	@echo "âœ… é–‹ç™ºã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Œäº†ï¼"

# =====================================
# ğŸš€ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ï¼‰
# =====================================
deploy:
	@echo "ğŸš€ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‡¦ç†é–‹å§‹..."
	$(SAIL) artisan optimize:clear
	$(SAIL) artisan config:cache
	$(SAIL) artisan route:cache
	@echo "âœ… æœ¬ç•ªã‚­ãƒ£ãƒƒã‚·ãƒ¥å†ç”Ÿæˆå®Œäº†ï¼"

# =====================================
# ğŸ§¨ ä¸å…·åˆæ™‚ã®å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒªã‚»ãƒƒãƒˆ
# =====================================
fix:
	@echo "ğŸ§¨ å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒªã‚»ãƒƒãƒˆä¸­..."
	$(SAIL) artisan optimize:clear
	@echo "âœ… å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆæœŸåŒ–å®Œäº†ï¼"

# =====================================
# ğŸ§¹ é–‹ç™ºç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
# =====================================
dev-clear:
	@echo "ğŸ§¹ Clearing Laravel caches..."
	$(SAIL) artisan config:clear
	$(SAIL) artisan route:clear
	$(SAIL) artisan view:clear
	@echo "âœ… Development caches cleared!"

# =====================================
# ğŸ§­ Git æ“ä½œã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
# =====================================
git-push:
	@if [ -z "$(m)" ]; then \
		echo "âŒ Please provide a commit message: make git-push m=\"Your message\""; \
		exit 1; \
	fi
	@echo "ğŸš€ Committing and pushing to $(BRANCH)..."
	git add .
	git commit -m "$(m)"
	git push origin $(BRANCH)
	@echo "âœ… Push completed!"

# =====================================
# âš™ï¸ é–‹ç™ºãƒ«ãƒ¼ãƒãƒ³ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ â†’ Gitã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ï¼‰
# =====================================
dev-flow:
	@if [ -z "$(m)" ]; then \
		echo "âŒ Please provide a commit message: make dev-flow m=\"Your message\""; \
		exit 1; \
	fi
	@echo "ğŸ” Running full development workflow..."
	make dev-clear
	make git-push m="$(m)"
	@echo "ğŸ‰ Workflow completed successfully!"

# =====================================
# .PHONY ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
# =====================================
.PHONY: dev-clear git-push dev-flow